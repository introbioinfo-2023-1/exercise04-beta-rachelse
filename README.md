---
Organization: Seoul National University
Course: Introduction to Bioinformatics
Exercise: Genome Assembly
Semester: Spring 2022
Professor: Asst. Prof. M. Steinegger (martin.steinegger@snu.ac.kr)
T.A: Jaebeom Kim (jbeom@snu.ac.kr)
---

# Exercise04: Homology Search and Phylogenomics

The goals of this exercise are:

    1. Perform MSA
    2. Build a tree using MSA
    3. Homology search

## General Instructions
1. There will be many files generated by tools used in this exercise. But please upload (git push) only the files that are specified with "(Result file: file name)".
2 . You don't have to care about main.sh in this exercise. Just write what you did in commandXX.sh files.


## Tools for the exercise
### Clustal-omega: [link for manual](https://github.com/GSLBiotech/clustal-omega)
CLUSTAL-OMEGA is a general purpose multiple sequence alignment program
for protein and DNA/RNA.
In this exercise, you will use the k-mer based assembly module of SPAdes.

### MMseqs2: [link for manual](https://github.com/soedinglab/mmseqs2)
MMseqs2 (Many-against-Many sequence searching) is a software suite to search and cluster huge protein and nucleotide sequence sets.

### FASTtree: [link for manual](http://www.microbesonline.org/fasttree/)
FastTree infers approximately-maximum-likelihood phylogenetic trees from alignments of nucleotide or protein sequences. FastTree can handle alignments with up to a million of sequences in a reasonable amount of time and memory.

## About the exercise

To submit your result, follow these steps:

- Step 1. Clone this template repository to your working directory and execute "setup.sh"
- Step 2. Fill in the command used in the command0X.sh in the "command" directory. The commands should generate the result of step 3. The result can either be printed to the terminal or written to a file.
- Step 3. Save the result files for each command.
- Step 4. Add edited files to git and commit
   ```sh
   git add "edited files"
   git commit -m "COMMIT MESSAGE"
   ```
- Step 5. Submit your answers by pushing the changes.
   ```sh
   git push origin master
   ```

---

## command01.sh
1. Construct an UPGMA tree based on the provided matrix. 
- You don't have to write any commands here. 
- Just write the representation of your tree using Newick Format. **tree.nwk** in result directory
- Rule for writing your Newick.
    1. The internal node that computed earlier comes left.
    2. In an internal node, node with earlier alphabetical order come to the left.
    3. Don't write the distances.
 
| |A|B|C|D|
|-|-|-|-|-|
|A|0|2|6|12|
|B|2|0|6|12|
|C|6|6|0|12|
|D|12|12|12|0|

---

## command02.sh
Suppose you are studying HIV-1. You collected protein sequences of 'gag' from different HIV-1 strains. To investigate the evolutionary relationship among the sequences, you want to visualize it by constructing a tree. To do so, you need MSA of them fisrt.


1. gag protein sequences of different HIV-1 strain is stored in **hiv1_gag.faa** in the data directory.  Using Clustal Omega, construct MSA and save the ouput as **hiv1_gag_msa.faa** in result directory. (Result file: **hiv1_gag_msa.faa**)
    - INPUT: 'hiv1_gag.faa'
    - OUNPUT: 'hiv1_gag_msa.faa'
    - Use only two parameters: -i, -o
 
2. You have a MSA result now, so let's build a tree using it. (Result file:**hiv1_gag_tree.nwk**)
    - INPUT: 'hiv1_gag_msa.faa'
    - OUTPUT: 'hiv1_gag_tree.nwk'
    - Use the default setting of fasttree. Just give fastree input path and output path.
    - Just type 'fasttree', then you can see a simplified manual.
  
---

## command03.sh
Scenario: You are studying plant physiology using foward genetics. You have isolated a mutant with increased crossover rate, and you found that the causal muatation occured on BZIP49 gene. But the gene is poorly annotated, providing no meaningful information. And you come up with an idea. "If I can find some homologous genes, I can get more clue about my gene based on the annotations of the homologs." So you started a homology search using MMseqs2 

1. Build a MMseqs2 database using Swiss-Prot reference proteins. (No resulf file)
    - HINT: Read the 'Search' part of MMseqs2 README.
    
2. Perform a non-iterative homology search. You have the sequence of BZIP49 in data directory. Save the result as **bzip49_homologs.m8** in result directory. Check how many homologs are found.(Result file: bzip49_homologs.m8)
    - INPUT: 'bzip49.faa'
    - OUTPUT: 'bzip49_homologs.m8'
    - HINT: Read the README of "https://github.com/soedinglab/mmseqs2"
    - Don't use extra options. Just give input path, database, output path, and tmp path.

3. Perform an iterative homology search using the same query, Save the result as **bzip49_homologs_iter.m8** in result directory. Check how many homologs are found.(Result file: bzip49_homologs_iter.m8)
    - INPUT: 'bzip49.faa'
    - OUTPUT: 'bzip49_homologs_iter.m8'
    - Set **--num-iteration** as 3
    - Don't use extra options. Just give input path, database, output path, and tmp path.
 
4. How many paralogs you can find in the results of command03-2,3? (Result file: paralogs_cnt.txt)
    - HINT: Use **--format-output** option to get more informations of hits.
    - Don't count the genes of interest.
    - Write it on file **paralogs_cnt.txt** in result directory.
    - Write the two number, seperating them only with comma. Write the number for command03-2 first.
   ```
   11,22
   ```

5. Paralogs go through different evolutionary paths, and some of them can lose or gain domains. To investigate what domains the paralogs have, you can search your paralogs against Pfam database which stores protein domain sequences. Then, let's build a MMseqs2 Pfam database. (No result file)
    - HINT: Use the same command used 3-1. Just replace **UniProtKB/Swiss-Prot** with **Pfam-A.seed**, giving different DB name.

6. Get the protein sequence of the most diverged hit (the last hit) of command03-3, and store it as **remote-protein.faa**. And search it to pfam database non-interatively. Store the result as **remote-protein-pfam.m8** in the result directory. (Result file: remote-protein-pfam.m8)
    - HINT: Run the search of 03-3 using **tseq** with **--format-output** to get the sequence.
    - Write the second column of MMseqs result as the header of **remote-protein.faa*

7. bZIP23 is a paralog of bZIP49, and its protein sequence is in data directory. Search it against the Pfam database, and store the result as **bzip23-pfam.m8** in the result directory. (Result file: bzip23-pfam.m8)

8. Write the IDs of the domains that exist only in one of the two protein (remote protein & bzip23) in **unique_domain.txt** in result directory. (Result file: unique_domain.txt)
    - Write them in alphanumeric order.
    - Don't divide the answer by the protein, but seperate them only by comma.
