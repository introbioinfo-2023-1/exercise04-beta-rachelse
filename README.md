| Organization | Course | Exercise | Semester | Professor | T.A. | 
| --- | --- | --- | --- | --- | --- |
| Seoul National University | Introduction to Bioinformatics | Bash introduction #1 | Spring 2023 | Asst. Prof. M. Steinegger (martin.steinegger@snu.ac.kr) | Luna Jang (jse9512@snu.ac.kr) <br /> Rachel Kim (eunbelivable@snu.ac.kr)|

# Exercise04: Homology Search and Phylogenomics

The goals of this exercise are:

    1. Perform MSA
    2. Build a tree using MSA
    3. Homology search

## General Instructions
1. There will be many files generated by tools used in this exercise. Please upload only the files in the **command** and **result** directory.
2. Especially in this exercise, we've prepared two directories, DB and intermediate. Please make sure to save database into DB directory, and save intermediate files, which are **not specified as result file**, into **intermediate** directory. (Those directories would be ignored by git)
3. Provided programs might take a long time to run. Please be patient.

## Tools for the exercise
### Clustal-omega: [link for manual](https://github.com/GSLBiotech/clustal-omega)
CLUSTAL-OMEGA is a general purpose multiple sequence alignment program for protein and DNA/RNA.

### MMseqs2: [link for manual](https://github.com/soedinglab/mmseqs2)
MMseqs2 (Many-against-Many sequence searching) is a software suite to search and cluster huge protein and nucleotide sequence sets.

### FASTtree: [link for manual](http://www.microbesonline.org/fasttree/)
FastTree infers approximately-maximum-likelihood phylogenetic trees from alignments of nucleotide or protein sequences. FastTree can handle alignments with up to a million of sequences in a reasonable amount of time and memory.

## About the exercise

To submit your result, follow these steps:

- Step 1. Clone this template repository to your working directory and execute "setup.sh"
- Step 2. Fill in the command used in the command0X.sh in the "command" directory. The commands should generate the result of step 3. The result can either be printed to the terminal or written to a file.
- Step 3. Save the result files for each command.
- Step 4. Add edited files to git and commit
   ```sh
   git add "edited files"
   git commit -m "COMMIT MESSAGE"
   ```
- Step 5. Submit your answers by pushing the changes.
   ```sh
   git push origin master
   ```

---

## command01
1. Construct an UPGMA tree based on the provided matrix. 
- You don't have to write any commands here. 
- Just write the representation of your tree using Newick Format. **tree.nwk** in result directory
- Rule for writing your Newick.
    1. The internal node that computed earlier comes left.
    2. In an internal node, node with earlier alphabetical order come to the left.
    3. Don't write the distances.
 
| |A|B|C|D|E|
|-|-|-|-|-|-|
|A|0|8|8|2|3|
|B|8|0|4|8|9|
|C|8|4|0|8|9|
|D|2|8|8|0|3|
|E|3|9|9|3|0| 

---

## command02.sh
Suppose you are studying HIV-1. You collected protein sequences of 'gag' from different HIV-1 strains. To investigate the evolutionary relationship among the sequences, you want to visualize it by constructing a tree. To do so, you need MSA of them fisrt.


1. gag protein sequences of different HIV-1 strain is stored in **hiv1_gag.faa** in the data directory.  Using Clustal Omega, construct MSA and save the ouput as **hiv1_gag_msa.faa** in result directory. (Result file: **hiv1_gag_msa.faa**)
    - INPUT: 'hiv1_gag.faa'
    - OUNPUT: 'hiv1_gag_msa.faa'
    - Use only two parameters: -i, -o
 
2. You have a MSA result now, so let's build a tree using it. (Result file:**hiv1_gag_tree.nwk**)
    - INPUT: 'hiv1_gag_msa.faa'
    - OUTPUT: 'hiv1_gag_tree.nwk'
    - Use the default setting of fasttree. Just give fastree input path and output path.
    - Just type 'fasttree', then you can see a simplified manual.
  
---

## command03.sh
Scenario: As you were preparing for exams, a wish to have a superpower to overcome sleepiness crossed your mind.
Intrigued, you discovered that BHLHE41 is a gene involved in circadian rhythm.
Now, you are curious to find out how the gene evolved and if modern society's changes in circadian rhythm have affected its evolution.
And you come up with an idea.
"If I can find some homologous genes, I can get more clue about the gene's evolution."
With this in mind, you begin a homology search using MMseqs2.

1. Build a MMseqs2 database using Swiss-Prot reference proteins. (No resulf file)
    - Build database in **DB** directory
    - HINT: Read the 'Search' part of MMseqs2 README.
    - :bangbang: If you made database in the wrong directory, you will not get point from this question. :bangbang:
    
2. Perform a non-iterative homology search. You have the sequence of BHLHE41 in data directory. Save the result as **bhlhe41_homologs.m8** in result directory. Check how many homologs are found.(Result file: bhlhe41_homologs.m8)
    - INPUT: 'bhlhe41.faa'
    - OUTPUT: 'bhlhe41_homologs.m8'
    - HINT: Read the README of "https://github.com/soedinglab/mmseqs2"
    - Don't use extra options. Just give input path, database, output path, and tmp path.

3. Perform an iterative homology search using the same query, Save the result as **bhlhe41_homologs_iter.m8** in result directory. Check how many homologs are found.(Result file: bhlhe41_homologs_iter.m8)
    - INPUT: 'bhlhe41.faa'
    - OUTPUT: 'bhlhe41_homologs_iter.m8'
    - Set **--num-iteration** as 3
    - Don't use extra options. Just give input path, database, output path, and tmp path.
 
4. How many paralogs you can find in the results of command03-2,3? (Result file: paralogs_cnt.txt)
    - HINT: Use **--format-output** option to get more informations of hits.
    - :bangbang: If you have intermediate files from mmseqs2, save them into the intermediate directory. :bangbang:
    - Don't count the gene of interest (query gene).
    - Write it on file **paralogs_cnt.txt** in result directory.
    - Write the two number separating lines. Write the number for command03-2 first.
   ```
   11 (number of paralogs of command03-2, non iterative homology)
   22 (number of paralogs of command03-3, iterative homology)
   ```

---

## command04.sh
Paralogs go through different evolutionary paths, and some of them can lose or gain domains. To investigate what domains the paralogs have, you can search your paralogs against Pfam database which stores protein domain sequences. Now, you want to find out what domains the paralogs of bhlhe41 have.

1. Build a MMseqs2 Pfam database. (No result file)
    - Build database in **DB** directory
    - HINT: Use the same command used 3-1. Just replace **UniProtKB/Swiss-Prot** with **Pfam-A.seed**, giving different DB name.
    - :bangbang: If you made database in the wrong directory, you will not get point from this question. :bangbang:

2. Get the protein sequence of the most diverged hit (the last hit) of command03-2, and then store it as a fasta file, **remote-protein.faa** in the intermediate directory. And search it to pfam database non-iteratively. Store the result as **remote-protein-pfam.m8** in the result directory. (Result file: remote-protein-pfam.m8)
    - HINT: Run the search of 03-2 using **tseq** with **--format-output** to get the sequence.
    - Write the second column of MMseqs result as the header of **remote-protein.faa*
    - :bangbang: Make sure save all the intermediate files (not specified as Result file) in the intermediate directory. :bangbang:

3. BMAL1 is a paralog of BHLHE41, and its protein sequence is in data directory. Search it non-iteratively against the Pfam database, and store the result as **bmal1-pfam.m8** in the result directory. (Result file: bmal1-pfam.m8)

4. Write the IDs of the domains that exist only in one of the two proteins (remote protein & bmal1) in **unique_domain.txt** in result directory. (Result file: unique_domain.txt)
    - Write them in alphanumeric order.
    ```
    PF00001.1
    PF00002.2
    PF00003.1
    ```
